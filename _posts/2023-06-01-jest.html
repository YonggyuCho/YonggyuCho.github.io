---
layout: post
title: "Jest 공부"
subtitle: "UnitTest"
date: 2023-06-02
background: ''
tags:
  - Unitest
  - javascipt
  - jest
  
---
<p> </p>
<h2 class="section-heading">1. jest 설치 및 설정 </h2>

<p> jest 설치: npm install jest --save-dev </p>

<p> 설치후 package.json 파일 안의 다음 부분을 수정합니다 </p>

<style>
        pre {
            background-color: #f4f4f4;
            padding: 10px;
        }
</style>
<pre>
        <code>
{
  "scripts": {
    "test": "jest"
  }
}
       </code>
</pre>
<p> * 테스트 실행: npm run test </p>

<p> 특정 테스트만 실행 : npm run test &lt;파일명 or 경로&gt; </p>

<h2>2. jest에 사용되는 함수</h2>

<strong>test() 함수</strong>
<p> 가장 일반적으로 쓰이는 test()이다.</p>
<pre>
        <code>
test("테스트 설명", () => {
  expect("검증 대상").toXxx("기대 결과");
});
       </code>
</pre>

<strong>describe() 함수</strong>
<p>describe안에는 test함수가 들어가야한다 </p>
<p>describe는 test함수들을 묶는 그룹이라 생각하면 된다.</p>

<p>테스트를 할 코드에는 </p>
<pre>
module.exports = { [함수명] }
</pre>
<p>위에 코드을적어 함수를 모듈로 정의해야한다.</p>
<pre>
const { [함수명] } = require('../libs/fetchData') 
</pre>
<p>테스트코드에는  위의 코드처럼 require를 써서 불러와야한다.</p>

<strong>toXXX (Test Matcher) 종류</strong>

<p>- toBe() : 같다 </p>
<p>- toEqual() : 같다 </p>

<p>toBe는 객체인 것들은 안된다. 그럴 때 쓰는 게 Equal</p>
<p>Jest는 toBe() 대신에 toEqual() 함수를 사용하라고 가이드해주고 있습니다</p>

<p>- toBeGreaterThanOrEqual() : 이상</p>
<p>- toBeLessThanOrEqual() : 이하</p>

<p>- toBeNull() : Null이 되는 경우를 검사한다.</p>
<p>- toBeTruthy() : True인지 검사</p>
<p>- toBeTruthy(), toBeFalsy()</p>

<p>- toHaveLength(), toContain()</p>
<p>- toMatch() : 문자열일때 사용 </p> 

<p>- toThrow()</p>

<h2>비동기 처리 Test </h2>

<p>자바의 비동기처리를 이해했으면 비동기처리 Test를 해보자</p> 

<p>밑의 코드는 test를 해볼 함수 fetchData의 정의이다.</p> 
<pre>
function fetchData() {
    return new Promise((res, rej) => {
        res('peanut butter')
    })
}
</pre>
<p>then()을 사용하여 test를 처리해보자</p> 
<pre>
test('the data is peanut butter', () => {   //'the data is peanut butter'는 test의 설명부분
    // fetchData 함수 테스트 (.then 함수 이용)
    return fetchData().then( (callback) =>{ 
        expect(callback).toEqual('peanut butter')
    })
})
</pre>

<p>fetchData호출하고 then을 써서 res의 값을 callback함수로 넣어줬다.</p> 
<p>return 문은 테스트 함수가 Promise를 반환하여 Jest에게 해당 Promise가 완료될 때까지 테스트를 기다리도록 알려주기 위해 사용된다.</p> 
<p>테스트 함수가 Promise를 반환하지 않는다면, Jest는 해당 함수가 동기 작업으로 간주하고 즉시 테스트를 완료합니다. 이 경우에는 비동기 작업이 완료되기 전에 테스트가 종료되어 제대로된 결과를 얻을 수 없다.</p> 

<pre>
test('the data is peanut butter', async () => {
    // fetchData 함수 테스트 (async await 함수 이용)
    expect(await fetchData()).toEqual('peanut butter')
})
</pre>

<p>위에 코드는 async와 await를 이용한 Test함수이다.</p> 
<p>async와 await는 자바스크립트의 비동기 처리를 위한 키워드이다. 함께 사용하여 비동기 코드를 동기적으로 작성할 수 있게 해준다.</p> 

<p>async: async는 함수 선언 앞에 붙여서 해당 함수를 비동기 함수로 정의한다. </p> 

<p>비동기 함수는 항상 Promise를 반환합니다 내부에서 await 키워드를 사용하여 비동기 작업이 완료될 때까지 기다릴 수 있다.</p> 

<p>await: await는 async 함수 내에서만 사용할 수 있다. </p> 

<p>await 키워드를 사용하면 Promise를 반환하는 비동기 작업이 완료되고 결과값을 반환할 때까지 실행을 일시 중지한다. </p> 

<p>이를 통해 비동기 작업의 결과를 동기적으로 받아올 수 있다</p> 

<pre>
test('the data is peanut butter', (done) => {
  // fetchData 함수 테스트 (done 함수 이용)
  fetchData().then((result) => {
    expect(result).toEqual('peanut butter');
    done();
  });
});
</pre>

<p>위의 코드에서 test 함수의 콜백 함수에 done 파라미터를 추가하여 Jest에게 비동기 작업이 완료되었음을 알린다. </p> 
<p>그 후 expect를 사용하여 결과를 검증하고, done()을 호출하여 Jest에게 완료를 알린다.</p> 
<p>done()을 호출하면 Jest는 해당 테스트 케이스를 종료하고 결과를 평가한다.</p> 
<p>따라서 done()을 호출하지 않으면 Jest는 비동기 작업이 완료될 때까지 테스트가 종료되지 않으므로 테스트가 제대로 완료되지 않는다.</p> 




